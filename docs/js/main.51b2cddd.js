(function(t){function e(e){for(var a,o,s=e[0],l=e[1],c=e[2],d=0,u=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);h&&h(e);while(u.length)u.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},i={main:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/flowchart/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var h=l;r.push(["c31f","chunk-vendors"]),n()})({1865:function(t,e,n){},"42b1":function(t,e,n){"use strict";var a=n("880c"),i=n.n(a);i.a},"880c":function(t,e,n){},a4b1:function(t,e,n){},c31f:function(t,e,n){"use strict";n.r(e);var a,i,r=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"inner-container"},[n("FlowChart",{attrs:{controlList:t.controlList,canvasScale:t.canvasScale,linkType:t.linkType}},[n("div",{staticClass:"bar",attrs:{slot:"top-bar"},slot:"top-bar"},[n("span",[t._v("\n          连线类型：\n          "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.linkType,expression:"linkType"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.linkType=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"polyline"}},[t._v("折线")]),n("option",{attrs:{value:"straight"}},[t._v("直线")])])])]),n("div",{staticClass:"bar",attrs:{slot:"bottom-bar"},slot:"bottom-bar"},[n("button",[t._v("测试底部栏")])])])],1)])},s=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"flowchart",class:t.prefixCls,attrs:{tabindex:"0"},on:{mousemove:t.handleFlowChartMouseMove,keydown:[t.handleFlowChartKeyDown,function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.handleDeleteCharts(e)},function(e){return e.ctrlKey?e.shiftKey||e.altKey||e.metaKey?null:t.handleCtrlKeyDown(e):null}]}},[t.readonly?t._e():n("DragZone",{attrs:{controlList:t.processedControlList},on:{"node-mousedown":t.handleDragZoneNodeMouseDown}}),n("ChartZone",t._g(t._b({ref:"chartzone",attrs:{flowChartData:t.flowChartData,isCreatingNode:t.isCreatingNode,flowChartCreateNode:t.createNode,isMouseInsideCanvas:t.isMouseInsideCanvas,canvasSize:t.processedCanvasSize},on:{"add-link":t.addLink,"take-snapshot":t.takeSnapshot,"replace-snapshot":t.replaceSnapshot,"revert-snapshot":t.revert}},"ChartZone",t.$props,!1),t.$listeners),[t._t("top-bar",null,{slot:"top-bar"}),t._t("bottom-bar",null,{slot:"bottom-bar"})],2),t.isCreatingNode&&t.isCreateNodeShow?n("Node",{class:t.prefixCls+"__creating-node",style:{zIndex:t.flowChartData.getMaxZ()+1,transform:"scale("+t.canvasScale+")"},attrs:{flowChartData:{},node:t.createNode,readonly:!0,isThumbnail:!0}}):t._e()],1)},c=[],h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.prefixCls},[t._l(t.controlList,(function(e,a){return[e.hidden?t._e():n("div",{key:a,class:t.prefixCls+"__control"},[n("Node",t._g({class:t.prefixCls+"__control-node",attrs:{flowChartData:{},node:t.nodes[a],readonly:!0,isThumbnail:!0}},t.$listeners)),n("div",{class:t.prefixCls+"__control-label"},[n("span",[t._v(t._s(e.label))])])],1)]}))],2)},d=[],u=function(){var t,e=this,n=e.$createElement,a=e._self._c||n;return a("div",{class:[e.prefixCls,(t={},t[e.prefixCls+"_selected"]=e.isSelected,t[e.prefixCls+"_readonly"]=e.readonly,t)],style:Object.assign({},e.containerSize,{left:e.node.style.x*(e.isThumbnail?1:e.canvasScale)+(e.isThumbnail?0:e.canvasPadding)+"px",top:e.node.style.y*(e.isThumbnail?1:e.canvasScale)+(e.isThumbnail?0:e.canvasPadding)+"px",zIndex:e.node.style.z,transform:"scale("+e.canvasScale+")"}),attrs:{tabindex:"-1"},on:{keydown:e.handleKeyDown}},[a("div",{ref:"container",class:e.prefixCls+"__rotate-container",style:{width:e.node.style.width+"px",height:e.node.style.height+"px",transform:"rotate("+e.node.style.rotate+"deg)"}},[a("div",{class:e.prefixCls+"__control-component"},[a(e.node.control.component,{tag:"component",attrs:{isEditing:e.isEditing,readonly:e.readonly,flowChartData:e.flowChartData,data:e.node.nodeData,node:e.node,isThumbnail:e.isThumbnail,injectProps:e.injectProps},on:{"update-data":e.handleUpdateNodeData,"delete-data":e.handleDeleteNodeData,"take-snapshot":e.handleTakeSnapshot,"replace-snapshot":e.handleReplaceSnapshot}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEditing,expression:"!isEditing"}],class:e.prefixCls+"__control-mask",style:e.maskStyle,on:{mousedown:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.handleMaskMouseDown(t)},function(t){return t.ctrlKey?e.handleMaskCtrlMouseDown(t):null}],dblclick:e.handleMaskDblClick}})])])},f=[],y={takeSnapshotOnEditChange:!0,maskWidth:"100%",maskHeight:"100%",maskOffsetX:0,maskOffsetY:0,resizable:!0},v={width:120,height:72,x:0,y:0,z:0,rotate:0},p={width:1050,height:1500},g=[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}],x="ws-flowchart";(function(t){t["straight"]="straight",t["bezier"]="bezier",t["polyline"]="polyline"})(a||(a={})),function(t){t["ArrowUp"]="ArrowUp",t["ArrowDown"]="ArrowDown",t["ArrowLeft"]="ArrowLeft",t["ArrowRight"]="ArrowRight"}(i||(i={}));var k=function(t){var e=t.getBoundingClientRect(),n=e.top,a=e.left;return{top:Math.trunc(n),left:Math.trunc(a)}},m=function(t,e){var n=k(e);return{x:Math.trunc(t.clientX-n.left),y:Math.trunc(t.clientY-n.top)}},C=function(t,e){var n=m(t,e),a=e.getBoundingClientRect(),i=a.width,r=a.height;return n.x>=0&&n.y>=0&&n.x<=i&&n.y<=r},w=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},b=function(t){return Math.PI*t/180},M=function(t,e,n){if(n%180===0)return Math.abs(t.x-e.x);if(n%90===0)return Math.abs(t.y-e.y);var a=b(n),i=1/Math.tan(a);return Math.abs(i*t.x+t.y-i*e.x-e.y)/Math.sqrt(Math.pow(i,2)+1)},S=function(t,e){return null==t?e:t},N=function(t,e){return{x:t.x*e,y:t.y*e}},D=n("cd3f"),A=n.n(D),L="".concat(x,"-node"),O=r["a"].extend({name:"Node",props:{node:{required:!0,type:Object},flowChartData:{required:!0,type:Object},injectProps:{},isSelected:Boolean,isGroupSelected:Boolean,isChartEditable:Function,isThumbnail:Boolean,readonly:Boolean,canvasScale:Number,canvasPadding:Number,rotatable:{type:Boolean,default:!0}},data:function(){return{prefixCls:L,isEditing:!1,nodeDataCache:A()(this.node.nodeData)}},computed:{maskStyle:function(){var t=this.node.control;return this.isThumbnail||this.readonly?{width:"100%",height:"100%",top:0,left:0}:{width:"".concat("number"===typeof t.maskWidth?"".concat(t.maskWidth,"px"):t.maskWidth),height:"".concat("number"===typeof t.maskHeight?"".concat(t.maskHeight,"px"):t.maskHeight),top:"".concat("number"===typeof t.maskOffsetY?"".concat(t.maskOffsetY,"px"):t.maskOffsetY),left:"".concat("number"===typeof t.maskOffsetX?"".concat(t.maskOffsetX,"px"):t.maskOffsetX)}},containerSize:function(){var t=this.node.getNodeContainerSize();return{width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}},methods:{handleKeyDown:function(t){this.isEditing&&t.stopPropagation()},handleUpdateNodeData:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.node.setData(t)&&e&&this.$emit("take-snapshot")},handleDeleteNodeData:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.node.deleteData(t)&&e&&this.$emit("take-snapshot")},handleTakeSnapshot:function(){this.$emit("take-snapshot")},handleReplaceSnapshot:function(){this.$emit("replace-snapshot")},handleClickOutside:function(t){this.$refs.container.contains(t.target)||(this.isEditing=!1)},handleMaskMouseDown:function(t){this.$emit("node-mousedown",this.node,t)},handleMaskCtrlMouseDown:function(t){this.$emit("node-ctrl-mousedown",this.node,t)},handleMouseMove:function(t){C(t,this.$refs.container)?this.$emit("node-mousemove",this.node,t):this.$emit("node-mousemove-outside",this.node,t)},handleMouseUp:function(t){C(t,this.$refs.container)?this.$emit("node-mouseup",this.node,t):this.$emit("node-mouseup-outside",this.node,t)},handleMaskDblClick:function(){this.readonly||this.isChartEditable(this.node)&&(this.isEditing=!0)}},mounted:function(){document.addEventListener("click",this.handleClickOutside),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)},beforeDestroy:function(){document.removeEventListener("click",this.handleClickOutside),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)},watch:{isEditing:function(t){t?this.nodeDataCache=A()(this.node.nodeData):this.node.control.takeSnapshotOnEditChange&&JSON.stringify(this.nodeDataCache)!==JSON.stringify(this.node.nodeData)&&this.$emit("take-snapshot")}}}),_=O,P=n("2877"),z=Object(P["a"])(_,u,f,!1,null,null,null),j=z.exports,E={},I=function(t){E=t};function $(t){return H(t)||B(t)||T()}function T(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function B(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function H(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function U(t,e,n){return e&&R(t.prototype,e),n&&R(t,n),t}var K=function(){function t(e,n){F(this,t),this.nodes=[],this.links=[],this.updateControlMap(n),this.nodes_=e.nodes.map((function(t){return new rt(t)})),this.links=e.links.map((function(t){return new ft(t)}))}return U(t,[{key:"updateControlMap",value:function(t){I(t)}},{key:"clearCharts",value:function(){this.nodes_=[],this.links=[]}},{key:"updateNodesRecord",value:function(){ft.nodes=this.nodes}},{key:"getCharts",value:function(){return[].concat($(this.nodes),$(this.links))}},{key:"getStartCharts",value:function(){var t=this;return{nodes:this.nodes.filter((function(e){return!t.links.some((function(t){return t.endNodeId===e.id}))})),links:this.links.filter((function(t){return!t.startNodeId}))}}},{key:"addNode",value:function(t){t.style=Object.assign({},{z:this.getMaxZ()+1},t.style);var e=new rt(t);return this.nodes.push(e),e}},{key:"addLink",value:function(t){t.z="number"===typeof t.z?t.z:this.getMaxZ()+1;var e=new ft(t);return this.links.push(e),e}},{key:"deleteChart",value:function(t,e){var n=this.nodes.findIndex((function(e){return e.id===t}));if(n>-1){var a=this.nodes[n];return e(a)?(this.links.forEach((function(t){t.startNodeId===a.id&&(t.startNodeId=null,t.startCoordinate=a.getAnchorCoordinate(t.startAnchor)),t.endNodeId===a.id&&(t.endNodeId=null,t.endCoordinate=a.getAnchorCoordinate(t.endAnchor))})),this.nodes.splice(n,1),a):null}var i=this.links.findIndex((function(e){return e.id===t}));if(i>-1){var r=this.links[i];return e(r)?(this.links.splice(i,1),r):null}return null}},{key:"deleteCharts",value:function(t,e){var n=this,a=[];return t.forEach((function(t){var i=n.deleteChart(t,e);i&&a.push(i)})),a}},{key:"setChartData",value:function(t,e){var n=this.findChartById(t);return!!n&&n.setData(e)}},{key:"deleteChartData",value:function(t,e){var n=this.findChartById(t);return!!n&&n.deleteData(e)}},{key:"findChartById",value:function(t){var e=[].concat($(this.nodes),$(this.links)),n=e.find((function(e){return e.id===t}));return n||null}},{key:"getMaxZ",value:function(){return this.nodes.length||this.links.length?Math.max.apply(Math,$(this.nodes.map((function(t){return t.z}))).concat($(this.links.map((function(t){return t.z}))))):-1}},{key:"nodes_",set:function(t){this.nodes=t,this.updateNodesRecord()}}]),t}();function W(t){return X(t)||Y(t)||Z()}function Z(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Y(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function X(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var G=function(t,e,n){var a=w(t,e),i=Math.acos((e.x-t.x)/a)+b(n),r=Math.asin((e.y-t.y)/a)+b(n);return{x:Math.trunc(e.x-a*Math.cos(i)),y:Math.trunc(e.y-a*Math.sin(r))}},q=function(t,e,n){var a=t.width,i=t.height,r=t.x,o=t.y,s=t.rotate,l={x:r+a*n.x,y:o+i*n.y},c={x:r+e.width/2,y:o+e.height/2};return G(l,c,s)},V=function(t){return{x:Math.min.apply(Math,W(t.map((function(t){return t.x})))),y:Math.min.apply(Math,W(t.map((function(t){return t.y}))))}},J=function(t,e,n){if(n%90===0)return{x:t.x,y:e.y};var a=b(n),i=Math.tan(a),r=1/i,o=(r*t.x+i*e.x+t.y-e.y)/(i+r);return{x:o,y:r*(t.x-o)+t.y}},Q=function(t,e,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],b(a));if(a%180===0){var o=M(n,t,a),s=0===e.x?t.x+i*Math.cos(r):t.x-i*Math.cos(r),l={x:s,y:n.y},c=M(n,l,a);(o<c||o<i)&&(n=l);var h=M(n,t,a+90),d=0===e.y?t.y+i*Math.cos(r):t.y-i*Math.cos(r),u={x:n.x,y:d},f=M(n,u,a+90);(h<f||h<i)&&(n=u)}return n},tt=n("c64e"),et=n.n(tt);function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function it(t,e,n){return e&&at(t.prototype,e),n&&at(t,n),t}var rt=function(){function t(e){nt(this,t),this.style=Object.assign({},v),this.id=e.id||et()(),this.controlName=e.controlName;var n=this.control;Object.assign(this.style,null!=n.defaultWidth?{width:n.defaultWidth}:{},null!=n.defaultHeight?{height:n.defaultHeight}:{},e.style),this.nodeData=A()(e.nodeData)||{}}return it(t,[{key:"setData",value:function(t){var e=this,n=Object.getOwnPropertyNames(t);return!!n.length&&(n.forEach((function(n){r["a"].set(e.nodeData,n,t[n])})),!0)}},{key:"deleteData",value:function(t){var e=this;return!!t.length&&(t.forEach((function(t){r["a"].delete(e.nodeData,t)})),!0)}},{key:"moveByOffset",value:function(t){this.style.x+=t.x,this.style.y+=t.y}},{key:"getNodeContainerSize",value:function(){var t=this.style,e=t.width,n=t.height,a=t.rotate,i=b(a),r=e*Math.abs(Math.cos(i))+n*Math.abs(Math.sin(i)),o=e*Math.abs(Math.sin(i))+n*Math.abs(Math.cos(i));return{width:r,height:o}}},{key:"getAnchorCoordinate",value:function(t){var e=this.getNodeContainerSize();return q(this.style,e,t)}},{key:"z",get:function(){var t=Number(this.style.z);return isNaN(t)?0:t}},{key:"control",get:function(){return E[this.controlName]||{}}},{key:"anchors",get:function(){return this.control?this.control.anchors||g:[]}},{key:"center",get:function(){var t=this.style,e=t.x,n=t.y,a=t.width,i=t.height;return{x:Math.trunc(e+a/2),y:Math.trunc(n+i/2)}}}]),t}();function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function lt(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),t}var ct=function(){function t(e,n){ot(this,t),this.x=e,this.y=n}return lt(t,[{key:"isOrthogonal",value:function(t){return 0===this.dot(t)}},{key:"isParallel",value:function(t){return this.x*t.y-t.x*this.y===0}},{key:"isSameDirection",value:function(t){return this.isParallel(t)&&this.dot(t)>0}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-t.x*this.y}},{key:"cosine",value:function(t){return 0===this.length||0===t.length?0:this.dot(t)/(this.length*t.length)}},{key:"normalize",value:function(){return new t(this.x/this.length,this.y/this.length)}},{key:"length",get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}]),t}();function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ut(t,e,n){return e&&dt(t.prototype,e),n&&dt(t,n),t}var ft=function(){function t(e){ht(this,t),this.editorPosition=.5,this.z=0,this.id=e.id||et()(),this.linkType=e.linkType||a.straight,this.polylinePoints=e.polylinePoints||[],this.startNodeId=e.startNodeId,this.startAnchor=Object.assign({x:0,y:0},e.startAnchor),this.startCoordinate=Object.assign({x:0,y:0},e.startCoordinate),this.endNodeId=e.endNodeId,this.endAnchor=Object.assign({x:0,y:0},e.endAnchor),this.endCoordinate=Object.assign({x:0,y:0},e.endCoordinate),this.editorPosition="number"===typeof e.editorPosition?e.editorPosition:this.editorPosition,this.z=e.z||this.z,this.linkData=Object.assign({text:""},A()(e.linkData)||{})}return ut(t,[{key:"setData",value:function(t){var e=this,n=Object.getOwnPropertyNames(t);return!!n.length&&(n.forEach((function(n){r["a"].set(e.linkData,n,t[n])})),!0)}},{key:"deleteData",value:function(t){var e=this;return!!t.length&&(t.forEach((function(t){r["a"].delete(e.linkData,t)})),!0)}},{key:"moveByOffset",value:function(t){this.startNodeId||(this.startCoordinate.x+=t.x,this.startCoordinate.y+=t.y),this.endNodeId||(this.endCoordinate.x+=t.x,this.endCoordinate.y+=t.y),this.linkType===a.polyline&&this.movePolylinePointsByOffset(t)}},{key:"movePolylinePointsByOffset",value:function(t){this.polylinePoints=this.polylinePoints.map((function(e){return{x:e.x+t.x,y:e.y+t.y}}))}},{key:"isLinkFree",value:function(){return!this.startNodeId||!this.endNodeId}},{key:"setPolylinePosition",value:function(t,e){var n=this.polylinePoints.length-1;if(!(t<=0||t>=n-1||n<3)){var a=this.polylinePoints[t],i=this.polylinePoints[t+1];a.x===i.x?(a.x=e,i.x=e):(a.y=e,i.y=e)}}},{key:"getPolylineDirectionByIndex",value:function(t){var e=this.pathGroups,n=e.length;if(t<0||t>n-1||n<1)return null;var a=e[t];return a.start.x===a.end.x?"y":"x"}},{key:"startCoordinate_",get:function(){var e=this;if(this.startNodeId){var n=t.nodes.find((function(t){return t.id===e.startNodeId}));if(n)return n.getAnchorCoordinate(this.startAnchor)}return this.startCoordinate}},{key:"endCoordinate_",get:function(){var e=this;if(this.endNodeId){var n=t.nodes.find((function(t){return t.id===e.endNodeId}));if(n)return n.getAnchorCoordinate(this.endAnchor)}return this.endCoordinate}},{key:"pathGroups",get:function(){var t=this.linkType,e=this.polylinePoints;if(t===a.straight||t===a.bezier)return[{start:this.startCoordinate_,end:this.endCoordinate_,isPolyline:!1}];var n=[],i=e.length;return e.forEach((function(t,a){e[a+1]&&n.push({start:t,end:e[a+1],isPolyline:0!==a&&a!==i-2})})),n}},{key:"pathLength",get:function(){return this.linkType===a.polyline?this.pathGroups.reduce((function(t,e){return t+w(e.start,e.end)}),0):w(this.startCoordinate_,this.endCoordinate_)}},{key:"editorCenterCoordinate",get:function(){var t=this.startCoordinate_,e=this.endCoordinate_;if(0===this.editorPosition)return t;if(1===this.editorPosition)return e;var n=this.pathLength*this.editorPosition;if(this.linkType===a.polyline){var i=this.pathGroups,r=0,o=0;i.some((function(t){var e=o+w(t.start,t.end);return e>n||(o=e,r++,!1)}));var s=n-o,l=this.getPolylineDirectionByIndex(r);if(!l)return t;var c=i[r].start,h=i[r].end;if("x"===l){var d=(h.x-c.x)/Math.abs(h.x-c.x);return{x:Math.trunc(c.x+s*d),y:Math.trunc(c.y)}}var u=(h.y-c.y)/Math.abs(h.y-c.y);return{x:Math.trunc(c.x),y:Math.trunc(c.y+s*u)}}var f,y,v=e.y-t.y,p=e.x-t.x;if(0===p)f=0,y=v*n<0?-n:n;else{var g=v/p;f=Math.sqrt(Math.pow(n,2)/(1+Math.pow(g,2))),y=g*f,new ct(p,v).cosine(new ct(f,y))<0&&(f=-f,y=-y)}return{x:Math.trunc(f+t.x),y:Math.trunc(y+t.y)}}}]),t}(),yt="".concat(x,"-drag-zone"),vt=r["a"].extend({name:"DragZone",components:{Node:j},props:{controlList:{type:Array,default:function(){return[]}}},data:function(){return{prefixCls:yt,nodes:[]}},watch:{controlList:{immediate:!0,handler:function(){var t=this;this.nodes=[],this.controlList.forEach((function(e){t.nodes.push(new rt({controlName:e.controlName,style:Object.assign({},v)}))}))}}}}),pt=vt,gt=Object(P["a"])(pt,h,d,!1,null,null,null),xt=gt.exports,kt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.prefixCls},[t.$scopedSlots["top-bar"]?n("div",{class:t.prefixCls+"__bar "+t.prefixCls+"__bar-top"},[t._t("top-bar")],2):t._e(),n("div",{ref:"background",class:t.prefixCls+"__background",on:{mousedown:t.handleBackgroundMouseDown,mousemove:t.handleBackgroundMouseMove,mouseup:t.handleBackgroundMouseUp}},[n("div",{ref:"canvas",class:t.prefixCls+"__canvas",style:{width:t.canvasSize.width*t.canvasScale+"px",height:t.canvasSize.height*t.canvasScale+"px",padding:t.canvasPadding+"px"}},[n("div",{class:t.prefixCls+"__canvas-background",style:{width:t.canvasSize.width*t.canvasScale+"px",height:t.canvasSize.height*t.canvasScale+"px",marginTop:t.canvasPadding+"px",marginLeft:t.canvasPadding+"px"}}),t._l(t.flowChartData.nodes,(function(e){return n("Node",{key:e.id,class:t.chartClassNameMethod(e),attrs:{node:e,isSelected:t.isNodeSelected(e),isChartEditable:t.isChartEditable,readonly:t.readonly,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding,flowChartData:t.flowChartData,injectProps:t.provideChartProps},on:{"node-mousedown":t.handleNodeMouseDown,"node-ctrl-mousedown":t.handleNodeCtrlMouseDown,"node-mousemove":t.handleNodeMouseMove,"node-mousemove-outside":t.handleNodeMouseMoveOutside,"take-snapshot":t.$listeners["take-snapshot"],"replace-snapshot":t.$listeners["replace-snapshot"]}})})),t._l(t.flowChartData.links,(function(e){return n("Link",{key:e.id,class:t.chartClassNameMethod(e),attrs:{link:e,nodes:t.flowChartData.nodes,linkEditor:t.linkEditor,linkEditorWidth:t.linkEditorWidth,linkEditorHeight:t.linkEditorHeight,isSelected:t.isLinkSelected(e),isChartEditable:t.isChartEditable,linkArrowWidth:t.linkArrowWidth,linkArrowHeight:t.linkArrowHeight,readonly:t.readonly,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding,flowChartData:t.flowChartData,injectProps:t.provideChartProps},on:{"link-mousedown":t.handleLinkMouseDown,"link-ctrl-mousedown":t.handleLinkCtrlMouseDown,"link-start-anchor-mousedown":t.handleLinkStartAnchorMouseDown,"link-end-anchor-mousedown":t.handleLinkEndAnchorMouseDown,"link-text-change":t.handleLinkTextChange,"take-snapshot":t.$listeners["take-snapshot"],"replace-snapshot":t.$listeners["replace-snapshot"]}})})),n("Node",{directives:[{name:"show",rawName:"v-show",value:t.isCreatingNode&&t.isMouseInsideCanvas,expression:"isCreatingNode && isMouseInsideCanvas"}],style:t.tailZStyle,attrs:{flowChartData:{},node:t.createNode,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding,readonly:!0,isThumbnail:!0}}),n("Link",{directives:[{name:"show",rawName:"v-show",value:t.isCreatingLink,expression:"isCreatingLink"}],style:t.tailZStyle,attrs:{flowChartData:t.flowChartData,link:t.createLink,nodes:t.flowChartData.nodes,linkArrowWidth:t.linkArrowWidth,linkArrowHeight:t.linkArrowHeight,readonly:!0,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding}}),n("Resizer",{directives:[{name:"show",rawName:"v-show",value:t.shouldResizerFrameShow,expression:"shouldResizerFrameShow"}],style:t.tailZStyle,attrs:{controlStyle:t.resizerArea,showResizers:t.showResizers,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding},on:{"resizer-mousedown":t.handleResizerMouseDown}}),t._l(t.flowChartData.nodes,(function(e){return[n("Anchor",{key:"anchor-"+e.id,style:t.tailZStyle,attrs:{node:e,flowChartData:t.flowChartData,isCreatingLink:t.isCreatingLink,createLink:t.createLink,isMovingLinkAnchor:t.isMovingLinkAnchor,moveLinkAnchor:t.moveLinkAnchor,isSelected:(t.isNodeSelected(e)||t.isMouseMoveNode(e))&&!t.isSelectingArea,readonly:t.readonly,canvasScale:t.canvasScale,canvasPadding:t.canvasPadding},on:{"node-anchor-mousedown":t.handleAnchorMouseDown,"node-anchor-mouseup":t.handleAnchorMouseUp,"node-anchor-mousemove":t.handleAnchorMouseMove}})]})),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isSelectingArea,expression:"isSelectingArea"}],class:t.prefixCls+"__selecting-area",style:Object.assign({},t.selectingAreaStyle,t.tailZStyle)}),n("AttachLine",{directives:[{name:"show",rawName:"v-show",value:t.isCreatingNode||t.isMovingChart||t.isResizingNode,expression:"isCreatingNode || isMovingChart || isResizingNode"}],style:t.tailZStyle,attrs:{horizontalLine:t.attachLine.horizontal,verticalLine:t.attachLine.vertical,canvasScale:t.canvasScale,canvasSize:t.canvasSize,canvasPadding:t.canvasPadding}})],2)]),t.$scopedSlots["bottom-bar"]?n("div",{class:t.prefixCls+"__bar "+t.prefixCls+"__bar-bottom"},[t._t("bottom-bar")],2):t._e()])},mt=[],Ct=function(){var t,e,n=this,a=n.$createElement,i=n._self._c||a;return i("div",{ref:"container",class:[n.prefixCls,(t={},t[n.prefixCls+"_same-node"]=n.isLinkingSameNode,t)],style:{width:n.linkWidth*n.canvasScale+"px",height:n.linkHeight*n.canvasScale+"px",left:n.linkLeft*n.canvasScale+this.canvasPadding+"px",top:n.linkTop*n.canvasScale+this.canvasPadding+"px",zIndex:n.link.z},attrs:{tabindex:"-1"},on:{keydown:n.handleKeyDown}},[i("svg",{class:n.prefixCls+"__svg",attrs:{width:n.linkWidth*n.canvasScale+"px",height:n.linkHeight*n.canvasScale+"px"}},[i("g",{class:[n.prefixCls+"__line",(e={},e[n.prefixCls+"__line_selected"]=n.isSelected,e)]},[n._l(n.pathGroups,(function(t,e){return i("g",{key:e},[i("path",{class:n.prefixCls+"__path",attrs:{d:"M"+t.start.x+" "+t.start.y+" L"+t.end.x+" "+t.end.y}}),i("path",{ref:"clickpath",refInFor:!0,class:n.prefixCls+"__path_hidden",style:{cursor:t.isPolyline?t.start.x===t.end.x?"ew-resize":"ns-resize":n.link.startNodeId||n.link.endNodeId?"pointer":"move"},attrs:{d:"M"+t.start.x+" "+t.start.y+" L"+t.end.x+" "+t.end.y},on:{mousedown:[function(a){return a.ctrlKey||a.shiftKey||a.altKey||a.metaKey?null:n.handleLinkMouseDown(a,t.isPolyline,e)},function(t){return t.ctrlKey?n.handleLinkCtrlMouseDown(t):null}],dblclick:n.handleLinkDblClick}})])})),i("polygon",{class:n.prefixCls+"__arrow",attrs:{points:n.arrowPoints}}),i("circle",{class:[n.prefixCls+"__anchor",n.prefixCls+"__anchor-start"],attrs:{cx:n.svgStartCoordinate.x*n.canvasScale,cy:n.svgStartCoordinate.y*n.canvasScale,r:n.anchorSize/2},on:{mousedown:n.handleStartAnchorMouseDown}}),i("circle",{class:[n.prefixCls+"__anchor",n.prefixCls+"__anchor-end"],attrs:{cx:n.svgEndCoordinate.x*n.canvasScale,cy:n.svgEndCoordinate.y*n.canvasScale,r:n.anchorSize/2},on:{mousedown:n.handleEndAnchorMouseDown}})],2)]),i("div",{directives:[{name:"show",rawName:"v-show",value:n.isEditing||n.link.linkData&&n.link.linkData.text,expression:"isEditing || (link.linkData && link.linkData.text)"}],ref:"editor",class:n.prefixCls+"__editor",style:Object.assign({},{width:n.linkEditorWidth+"px",height:n.linkEditorHeight+"px"},n.editorPositionStyle),on:{mousedown:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:n.handleLinkMouseDown(t)},function(t){return t.ctrlKey?n.handleLinkCtrlMouseDown(t):null}],dblclick:n.handleLinkDblClick}},[n.linkEditor?[i(n.linkEditor,n._b({tag:"component",attrs:{isEditing:n.isEditing,injectProps:n.injectProps},on:{"update-data":n.handleUpdateLinkData,"delete-data":n.handleDeleteLinkData,"take-snapshot":n.handleTakeSnapshot,"replace-snapshot":n.handleReplaceSnapshot}},"component",n.$props,!1))]:[i("pre",{directives:[{name:"show",rawName:"v-show",value:!n.isEditing&&n.link.linkData&&n.link.linkData.text,expression:"!isEditing && link.linkData && link.linkData.text"}],class:[n.prefixCls+"__editor-pre"]},[n._v(n._s(n.link.linkData&&n.link.linkData.text))]),i("textarea",{directives:[{name:"show",rawName:"v-show",value:n.isEditing,expression:"isEditing"}],ref:"text",class:n.prefixCls+"__editor-textarea",domProps:{value:n.link.linkData.text},on:{input:n.handleLinkTextChange}})]],2)])},wt=[],bt=function(t,e,n,a){var i=1,r=a/2;if(t.x===e.x){var o={x:t.x,y:t.y<e.y?e.y-n:e.y+n};return[{x:o.x-r,y:o.y},{x:o.x+r,y:o.y},{x:e.x,y:t.y<e.y?e.y+i:e.y-i}]}if(t.y===e.y){var s={x:t.x<e.x?e.x-n:e.x+n,y:t.y};return[{x:s.x,y:s.y-r},{x:s.x,y:s.y+r},{x:t.x<e.x?e.x+i:e.x-i,y:e.y}]}var l=Math.atan((e.y-t.y)/(e.x-t.x)),c=(t.x-e.x)/Math.abs(t.x-e.x),h={x:e.x+n*Math.cos(l)*c,y:e.y+n*Math.sin(l)*c},d=(e.y-t.y)/(e.x-t.x),u=-1,f=t.y-d*t.x,y=1/d,v=y*h.x+h.y,p=r*Math.sqrt(Math.pow(d,2)+Math.pow(u,2)),g=(p-f+v)/(d+y),x=-y*g+v,k=(-p-f+v)/(d+y),m=-y*k+v,C=w(t,e),b=C+i,M=t.x-b*(t.x-e.x)/C,S=t.y-b*(t.y-e.y)/C;return[{x:g,y:x},{x:k,y:m},{x:M,y:S}]},Mt=function(t,e){var n=t.startNodeId?e.nodes.find((function(e){return e.id===t.startNodeId})):null,a=n?E[n.controlName]:null,i=t.endNodeId?e.nodes.find((function(e){return e.id===t.endNodeId})):null,r=i?E[i.controlName]:null;if(null!=n&&n===i){if(!a)return!0;if(a.disableLinkSelf)return!1;var o=a.anchors;if(!o)return!0;var s=o.find((function(e){return e.x===t.startAnchor.x&&e.y===t.startAnchor.y})),l=o.find((function(e){return e.x===t.endAnchor.x&&e.y===t.endAnchor.y}));return!(null!=s&&s===l&&s.disableLinkSelf)}if(n&&a){var c=e.links.filter((function(t){return t.startNodeId===n.id||t.endNodeId===n.id})),h=c.filter((function(e){return e.startNodeId===n.id&&e.id!==t.id}));if(h.length+1>S(a.maxLinkOut,1/0))return!1;var d=a.anchors;if(d){var u=d.find((function(e){return e.x===t.startAnchor.x&&e.y===t.startAnchor.y})),f=h.filter((function(e){return e.startAnchor.x===t.startAnchor.x&&e.startAnchor.y===t.startAnchor.y}));if(null!=u&&f.length>S(u.maxOut,1/0))return!1}}if(i&&r){var y=e.links.filter((function(t){return t.startNodeId===i.id||t.endNodeId===i.id})),v=y.filter((function(e){return e.endNodeId===i.id&&e.id!==t.id}));if(v.length+1>S(r.maxLinkIn,1/0))return!1;var p=r.anchors;if(p){var g=p.find((function(e){return e.x===t.endAnchor.x&&e.y===t.endAnchor.y})),x=v.filter((function(e){return e.endAnchor.x===t.endAnchor.x&&e.endAnchor.y===t.endAnchor.y}));if(null!=g&&x.length>S(g.maxIn,1/0))return!1}}return!0};function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Dt(t,e,n){return e&&Nt(t.prototype,e),n&&Nt(t,n),t}var At=function(){function t(e,n){St(this,t),this.heap=[],this.compareFunction=function(t,e){return"number"===typeof t&&"number"===typeof e?t===e?0:(t-e)/Math.abs(t-e):0},"function"===typeof n&&(this.compareFunction=n),this.heap=e;for(var a=Math.floor((this.length-2)/2);a>=0;a--)this.down(a)}return Dt(t,[{key:"insert",value:function(t){this.heap.push(t),this.up()}},{key:"delete",value:function(){var t=this.heap.shift(),e=this.heap.pop();return null!=e&&(this.heap.unshift(e),this.down(0)),t}},{key:"up",value:function(t){var e="number"===typeof t?t:this.length-1;if(!(e<=0)){var n=this.heap[e],a=Math.floor((e-1)/2);while(a>=0&&-1===this.compareFunction(n,this.heap[a]))this.heap[e]=this.heap[a],e=a,a=Math.floor((e-1)/2);this.heap[e]=n}}},{key:"down",value:function(t){var e=this.heap[t],n=t,a=2*n+1;while(a<this.length){var i=a,r=a+1;if(r<this.length&&-1===this.compareFunction(this.heap[r],this.heap[a])&&(i=r),1!==this.compareFunction(e,this.heap[i]))break;this.heap[n]=this.heap[i],n=i,a=2*n+1}this.heap[n]=e}},{key:"length",get:function(){return this.heap.length}},{key:"array",get:function(){return this.heap}}]),t}();function Lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Ot(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(n),!0).forEach((function(e){_t(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Pt=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},zt=function(t,e,n,a){var i={},r=Pt(t,e),o=Ot({},t,{g:0,h:r,f:r,t:0,parent:null});i[t.x]=_t({},t.y,o);var s=new At([o],(function(t,e){return t.f!==e.f?(t.f-e.f)/Math.abs(t.f-e.f):Math.abs(t.h-t.g)!==Math.abs(e.h-e.g)?(Math.abs(t.h-t.g)-Math.abs(e.h-e.g))/Math.abs(Math.abs(t.h-t.g)-Math.abs(e.h-e.g)):t.t!==e.t?(t.t-e.t)/Math.abs(t.t-e.t):0})),l=new Set(["".concat(t.x,",").concat(t.y)]),c=new Set;while(s.length){var h=s.delete(),d="".concat(h.x,",").concat(h.y);l.delete(d),c.add(d);var u=n(h).filter((function(t){return!c.has("".concat(t.x,",").concat(t.y))})),f=!0,y=!1,v=void 0;try{for(var p,g=u[Symbol.iterator]();!(f=(p=g.next()).done);f=!0){var x=p.value;if(x.x===e.x&&x.y===e.y){var k=[],m=h;while(m)k.unshift({x:m.x,y:m.y}),m=i[m.x][m.y].parent;return[].concat(k,[Object.assign({},e)])}var C=l.has("".concat(x.x,",").concat(x.y));if(C){var w=i[x.x][x.y],b=a(h,w);if(h.g+b<w.g){w.g=h.g+b,w.f=w.g+w.h;var M=h.parent;w.t=h.t+(M&&new ct(M.x-h.x,M.y-h.y).isParallel(new ct(x.x-h.x,x.y-h.y))?0:1),s.up(s.array.indexOf(w)),i[x.x][x.y]=w}}else{var S=h.g+a(h,x),N=Pt(x,e),D=h.t;if(h.parent){var A=h.parent;new ct(A.x-h.x,A.y-h.y).isParallel(new ct(x.x-h.x,x.y-h.y))||D++}var L=Ot({},x,{g:S,h:N,f:S+N,t:D,parent:h});i[x.x]||(i[x.x]={}),i[x.x][x.y]=L,s.insert(L),l.add("".concat(x.x,",").concat(x.y))}}}catch(O){y=!0,v=O}finally{try{f||null==g.return||g.return()}finally{if(y)throw v}}}return null},jt=zt;function Et(t){return Tt(t)||$t(t)||It()}function It(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function $t(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function Tt(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var Bt=30,Ht=function(t,e){var n=new ct(t[0].x-t[1].x,t[0].y-t[1].y),a=new ct(e[0].x-e[1].x,e[0].y-e[1].y);return n.isParallel(a)},Ft=function(t,e){return Math.min(t[0].x,t[1].x)<=Math.max(e[0].x,e[1].x)&&Math.min(e[0].x,e[1].x)<=Math.max(t[0].x,t[1].x)&&Math.min(t[0].y,t[1].y)<=Math.max(e[0].y,e[1].y)&&Math.min(e[0].y,e[1].y)<=Math.max(t[0].y,t[1].y)},Rt=function(t,e){var n=new ct(t[1].x-t[0].x,t[1].y-t[0].y),a=new ct(e[0].x-t[0].x,e[0].y-t[0].y),i=new ct(e[1].x-t[0].x,e[1].y-t[0].y);return n.cross(a)*n.cross(i)},Ut=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return n?Ft(t,e)&&Rt(t,e)<=0&&Rt(e,t)<=0:Ft(t,e)&&Rt(t,e)<0&&Rt(e,t)<0},Kt=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.some((function(e){return Ut(t,e,n)}))},Wt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bt,n=t.style,a=n.x,i=n.y,r=n.width,o=n.height,s=n.rotate,l={x:a+r/2,y:i+o/2};return[G({x:a-e,y:i-e},l,s),G({x:a-e,y:i+o+e},l,s),G({x:a+r+e,y:i-e},l,s),G({x:a+r+e,y:i+o+e},l,s)]},Zt=function(t){return[[t[0],t[1]],[t[0],t[2]],[t[2],t[3]],[t[1],t[3]]]},Yt=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.style,i=a.x,r=a.y,o=a.width,s=a.height;return n?t.x<=i||t.x>=i+o||t.y<=r||t.y>=r+s:t.x<i||t.x>i+o||t.y<r||t.y>r+s},Xt=function(t,e){return e.some((function(e){return Ht(t,e)&&Ut(t,e)}))},Gt=function(t,e,n,a){var i=new ct(1,0),r=new ct(0,1);if(e&&n){var o=[];0===n.y?o.push.apply(o,[e.getAnchorCoordinate({x:0,y:0}),e.getAnchorCoordinate({x:1,y:0})]):1===n.x?o.push.apply(o,[e.getAnchorCoordinate({x:1,y:0}),e.getAnchorCoordinate({x:1,y:1})]):1===n.y?o.push.apply(o,[e.getAnchorCoordinate({x:0,y:1}),e.getAnchorCoordinate({x:1,y:1})]):o.push.apply(o,[e.getAnchorCoordinate({x:0,y:0}),e.getAnchorCoordinate({x:0,y:1})]);var s,l=new ct(o[0].x-t.x,o[0].y-t.y),c=new ct(o[1].x-t.x,o[1].y-t.y),h=i.dot(l)/(i.length*l.length),d=i.dot(c)/(i.length*c.length),u=Math.abs(h-d),f=r.dot(l)/(r.length*l.length),y=r.dot(c)/(r.length*c.length),v=Math.abs(f-y);return s=u<=v?{x:a.x,y:t.y}:{x:t.x,y:a.y},s.x===a.x&&s.y===a.y&&(s=t),[s]}return[{x:t.x,y:a.y},{x:a.x,y:t.y}]},qt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=[n,a].filter((function(t){return t instanceof rt})),o=[],s=[],l=null,c=null;n&&(o.push.apply(o,Et(Wt(n))),l=Zt(Wt(n,0)),s.push(l)),a&&(o.push.apply(o,Et(Wt(a))),c=Zt(Wt(a,0)),s.push(c));var h=[];t.x!==e.x&&t.y!==e.y&&h.push.apply(h,[{x:t.x,y:Math.min(t.y,e.y)+Math.trunc(Math.abs(t.y-e.y)/2)},{x:Math.min(t.x,e.x)+Math.trunc(Math.abs(t.x-e.x)/2),y:t.y}]);var d=function(n){var d=[],u=[].concat(o,h),f=u.reduce((function(t,e){return t.concat([{x:e.x,y:n.y},{x:n.x,y:e.y}])}),[]);return f.push.apply(f,Et(Gt(e,a,i,n))),d=Et(new Set(f.map((function(t){return"".concat(t.x,",").concat(t.y)})))).map((function(t){var e=t.split(",");return{x:Number(e[0]),y:Number(e[1])}})),d=d.filter((function(a){var i=[n,a];return a.x===e.x&&a.y===e.y?r.every((function(t){return Yt(n,t,!1)}))&&!s.some((function(t){return Kt(i,t,!1)}))&&(!c||!Xt(i,c)):n.x===t.x&&n.y===t.y?r.every((function(t){return Yt(a,t)}))&&!s.some((function(t){return Kt(i,t,!1)}))&&(!l||!Xt(i,l)):!s.some((function(t){return Kt(i,t)}))})),d};return jt(t,e,d,w)||[]},Vt=function(t,e){var n=t.startNodeId?e.findChartById(t.startNodeId):null,a=t.endNodeId?e.findChartById(t.endNodeId):null;if(null!==n||null!==a){var i=n?n.getAnchorCoordinate(t.startAnchor):t.startCoordinate,r=a?a.getAnchorCoordinate(t.endAnchor):t.endCoordinate,o=qt(i,r,n,a,t.endAnchor);return o.length||(o=qt(i,r)),o}return qt(t.startCoordinate,t.endCoordinate)};function Jt(t){return ee(t)||te(t)||Qt()}function Qt(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function te(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function ee(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var ne="".concat(x,"-link"),ae=10,ie=30,re=r["a"].extend({name:"Link",props:{link:{required:!0,type:Object},nodes:{type:Array,default:function(){return[]}},flowChartData:{required:!0,type:Object},linkEditor:Object,linkEditorWidth:Number,linkEditorHeight:Number,injectProps:{},isSelected:Boolean,isGroupSelected:Boolean,isChartEditable:Function,linkArrowWidth:Number,linkArrowHeight:Number,readonly:Boolean,canvasScale:Number,canvasPadding:Number},data:function(){return{prefixCls:ne,anchorSize:ie,isEditing:!1,linkDataCache:A()(this.link.linkData)}},computed:{isLinkingSameNode:function(){return null!==this.link.startNodeId&&this.link.startNodeId===this.link.endNodeId},startCoordinate:function(){var t=this.link.startCoordinate_;return{x:t.x,y:t.y}},endCoordinate:function(){var t=this.link.endCoordinate_;return{x:t.x,y:t.y}},linkWidth:function(){var t=this.link,e=t.linkType,n=t.polylinePoints;if(e===a.straight||e===a.bezier)return Math.abs(this.startCoordinate.x-this.endCoordinate.x)+2*ae;var i=[].concat(Jt(n),[this.startCoordinate,this.endCoordinate]).map((function(t){return t.x}));return Math.max.apply(Math,Jt(i))-Math.min.apply(Math,Jt(i))+2*ae},linkHeight:function(){var t=this.link,e=t.linkType,n=t.polylinePoints;if(e===a.straight||e===a.bezier)return Math.abs(this.startCoordinate.y-this.endCoordinate.y)+2*ae;var i=[].concat(Jt(n),[this.startCoordinate,this.endCoordinate]).map((function(t){return t.y}));return Math.max.apply(Math,Jt(i))-Math.min.apply(Math,Jt(i))+2*ae},linkLeft:function(){var t=this.link,e=t.linkType,n=t.polylinePoints;return e===a.straight||e===a.bezier?Math.min(this.startCoordinate.x,this.endCoordinate.x)-ae:Math.min.apply(Math,Jt([].concat(Jt(n),[this.startCoordinate,this.endCoordinate]).map((function(t){return t.x}))))-ae},linkTop:function(){var t=this.link,e=t.linkType,n=t.polylinePoints;return e===a.straight||e===a.bezier?Math.min(this.startCoordinate.y,this.endCoordinate.y)-ae:Math.min.apply(Math,Jt([].concat(Jt(n),[this.startCoordinate,this.endCoordinate]).map((function(t){return t.y}))))-ae},svgStartCoordinate:function(){return{x:this.startCoordinate.x-this.linkLeft,y:this.startCoordinate.y-this.linkTop}},svgEndCoordinate:function(){return{x:this.endCoordinate.x-this.linkLeft,y:this.endCoordinate.y-this.linkTop}},arrowPoints:function(){var t,e=this,n=this.link,i=n.linkType,r=n.polylinePoints;if(i===a.straight||i===a.bezier)t=bt(this.svgStartCoordinate,this.svgEndCoordinate,this.linkArrowWidth,this.linkArrowHeight);else{var o=this.svgStartCoordinate,s=r[r.length-2];s&&(o=this.getSVGPoint(s)),t=bt(o,this.svgEndCoordinate,this.linkArrowWidth,this.linkArrowHeight)}return t.map((function(t){var n=e.getScaledPoint(t);return"".concat(n.x," ").concat(n.y)})).join(" ")},pathGroups:function(){var t=this;return this.link.pathGroups.map((function(e){return{start:t.getScaledPoint(t.getSVGPoint(e.start)),end:t.getScaledPoint(t.getSVGPoint(e.end)),isPolyline:e.isPolyline}}))},editorPositionStyle:function(){var t=this.getSVGPoint(this.link.editorCenterCoordinate);return{top:"".concat(t.y-this.linkEditorHeight/2,"px"),left:"".concat(t.x-this.linkEditorWidth/2,"px")}}},methods:{getSVGPoint:function(t){return{x:t.x-this.linkLeft,y:t.y-this.linkTop}},getScaledPoint:function(t){return{x:t.x*this.canvasScale,y:t.y*this.canvasScale}},updatePolylinePoints:function(){this.link.polylinePoints=Vt(this.link,this.flowChartData)},handleKeyDown:function(t){this.isEditing&&t.stopPropagation()},handleLinkMouseDown:function(t,e,n){this.isEditing||this.$emit("link-mousedown",this.link,t,e,n)},handleLinkCtrlMouseDown:function(t){this.isEditing||this.$emit("link-ctrl-mousedown",this.link,t)},handleLinkDblClick:function(){this.isEditing||this.readonly||this.isChartEditable(this.link)&&(this.isEditing=!0)},handleStartAnchorMouseDown:function(t){this.$emit("link-start-anchor-mousedown",this.link,t)},handleEndAnchorMouseDown:function(t){this.$emit("link-end-anchor-mousedown",this.link,t)},handleUpdateLinkData:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.link.setData(t)&&e&&this.$emit("take-snapshot")},handleDeleteLinkData:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.link.deleteData(t)&&e&&this.$emit("take-snapshot")},handleTakeSnapshot:function(){this.$emit("take-snapshot")},handleReplaceSnapshot:function(){this.$emit("replace-snapshot")},handleLinkTextChange:function(t){this.$emit("link-text-change",this.link,t.target&&t.target.value)}},created:function(){this.unwatchStartEndCoordinate=this.$watch((function(){return{startCoordinate:this.startCoordinate,endCoordinate:this.endCoordinate}}),(function(t,e){if(this.link.linkType===a.polyline){var n=new ct(t.endCoordinate.x-t.startCoordinate.x,t.endCoordinate.y-t.startCoordinate.y),i=new ct(e.endCoordinate.x-e.startCoordinate.x,e.endCoordinate.y-e.startCoordinate.y);n.isSameDirection(i)&&n.length===i.length||this.updatePolylinePoints()}}),{deep:!0})},mounted:function(){this.handleClickOutside=function(t){this.$refs.container.contains(t.target)||(this.isEditing=!1)},this.handleClickOutside=this.handleClickOutside.bind(this),document.addEventListener("click",this.handleClickOutside)},beforeDestroy:function(){this.unwatchStartEndCoordinate&&this.unwatchStartEndCoordinate(),document.removeEventListener("click",this.handleClickOutside)},watch:{isEditing:function(t){var e=this;t?(this.linkDataCache=A()(this.link.linkData),this.$nextTick((function(){e.$refs.text&&e.$refs.text.focus()}))):JSON.stringify(this.linkDataCache)!==JSON.stringify(this.link.linkData)&&this.$emit("take-snapshot")}}}),oe=re,se=Object(P["a"])(oe,Ct,wt,!1,null,null,null),le=se.exports,ce=function(){var t,e=this,n=e.$createElement,a=e._self._c||n;return a("div",{class:[e.prefixCls+"__anchor-container",(t={},t[e.prefixCls+"__anchor-container_selected"]=e.isSelected,t[e.prefixCls+"__anchor-container_readonly"]=e.readonly,t)],style:{left:e.node.style.x*e.canvasScale+e.canvasPadding+"px",top:e.node.style.y*e.canvasScale+e.canvasPadding+"px"}},e._l(e.node.anchors,(function(t,n){var i;return a("div",{key:n,class:[e.prefixCls+"__anchor",(i={},i[e.prefixCls+"__anchor_not-allowed"]=e.isAnchorNotAllowed(t),i[e.prefixCls+"__anchor_will-link"]=e.isAnchorToBeLinked(t),i)],style:e.getAnchorStyle(t),on:{mousedown:function(n){return e.handleAnchorMouseDown(t)},mouseup:function(n){return e.handleAnchorMouseUp(t,n)},mousemove:function(n){return e.handleAnchorMouseMove(t,n)}}})})),0)},he=[];function de(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?de(Object(n),!0).forEach((function(e){fe(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function fe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ye="".concat(x,"-node"),ve=1,pe=4,ge=r["a"].extend({name:"Anchor",props:{node:{required:!0,type:Object},flowChartData:{required:!0,type:Object},isCreatingLink:Boolean,createLink:Object,isMovingLinkAnchor:Boolean,moveLinkAnchor:Object,isSelected:Boolean,readonly:Boolean,canvasScale:Number,canvasPadding:Number},data:function(){return{prefixCls:ye}},methods:{getAnchorStyle:function(t){var e=this.getAnchorPosition(t);return{top:"".concat(e.top,"px"),left:"".concat(e.left,"px")}},getAnchorPosition:function(t){var e=this.node.style,n=e.width,a=e.height;return{top:(a*this.canvasScale-ve)*t.y-pe,left:(n*this.canvasScale-ve)*t.x-pe}},isAnchorNotAllowed:function(t){var e=this;if(!this.node.control)return!1;if(!this.isCreatingLink&&!this.isMovingLinkAnchor){var n=this.flowChartData.links,a=n.filter((function(t){return t.startNodeId===e.node.id}));if(a.length===S(this.node.control.maxLinkOut,1/0))return!0;if(a.length===S(t.maxOut,1/0))return!0}if(this.isCreatingLink){var i=ue({id:""},this.createLink,{},{endNodeId:this.node.id,endAnchor:t});return!Mt(i,this.flowChartData)}return!!this.isMovingLinkAnchor&&!Mt(this.moveLinkAnchor,this.flowChartData)},isAnchorToBeLinked:function(t){if(this.isCreatingLink){var e=this.createLink.endAnchor;return this.createLink.endNodeId===this.node.id&&e.x===t.x&&e.y===t.y}return!(!this.isMovingLinkAnchor||!this.moveLinkAnchor)&&(this.moveLinkAnchor.startNodeId===this.node.id&&this.moveLinkAnchor.startAnchor.x===t.x&&this.moveLinkAnchor.startAnchor.y===t.y||this.moveLinkAnchor.endNodeId===this.node.id&&this.moveLinkAnchor.endAnchor.x===t.x&&this.moveLinkAnchor.endAnchor.y===t.y)},handleAnchorMouseDown:function(t){t.disableOut||this.isAnchorNotAllowed(t)||this.$emit("node-anchor-mousedown",this.node,t)},handleAnchorMouseUp:function(t,e){t.disableIn||this.$emit("node-anchor-mouseup",this.node,t,e)},handleAnchorMouseMove:function(t,e){this.$emit("node-anchor-mousemove",this.node,t,e)}}}),xe=ge,ke=Object(P["a"])(xe,ce,he,!1,null,null,null),me=ke.exports,Ce=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.prefixCls+"__container"],style:{left:t.controlStyle.x*t.canvasScale+t.canvasPadding+"px",top:t.controlStyle.y*t.canvasScale+t.canvasPadding+"px"}},[n("div",{class:t.prefixCls+"__border "+t.prefixCls+"__border_horizontal "+t.prefixCls+"__border_top",style:{width:t.controlStyle.width*t.canvasScale+"px",top:0}}),n("div",{class:t.prefixCls+"__border "+t.prefixCls+"__border_horizontal "+t.prefixCls+"__border_bottom",style:{width:t.controlStyle.width*t.canvasScale+"px",top:t.controlStyle.height*t.canvasScale-1+"px"}}),n("div",{class:t.prefixCls+"__border "+t.prefixCls+"__border_vertical "+t.prefixCls+"__border_left",style:{height:t.controlStyle.height*t.canvasScale+"px",left:0}}),n("div",{class:t.prefixCls+"__border "+t.prefixCls+"__border_vertical "+t.prefixCls+"__border_right",style:{height:t.controlStyle.height*t.canvasScale+"px",left:t.controlStyle.width*t.canvasScale-1+"px"}}),t.showResizers?[n("div",{class:t.prefixCls+"__resizer "+t.prefixCls+"__resizer_top-left",style:{top:-t.resizerHalfSize+"px",left:-t.resizerHalfSize+"px"},on:{mousedown:function(e){return t.handleResizerMouseDown(e,"00")}}}),n("div",{class:t.prefixCls+"__resizer "+t.prefixCls+"__resizer_top-right",style:{top:-t.resizerHalfSize+"px",left:t.controlStyle.width*t.canvasScale-t.resizerHalfSize-1+"px"},on:{mousedown:function(e){return t.handleResizerMouseDown(e,"10")}}}),n("div",{class:t.prefixCls+"__resizer "+t.prefixCls+"__resizer_bottom-left",style:{top:t.controlStyle.height*t.canvasScale-t.resizerHalfSize-1+"px",left:-t.resizerHalfSize+"px"},on:{mousedown:function(e){return t.handleResizerMouseDown(e,"01")}}}),n("div",{class:t.prefixCls+"__resizer "+t.prefixCls+"__resizer_bottom-right",style:{top:t.controlStyle.height*t.canvasScale-t.resizerHalfSize-1+"px",left:t.controlStyle.width*t.canvasScale-t.resizerHalfSize-1+"px"},on:{mousedown:function(e){return t.handleResizerMouseDown(e,"11")}}})]:t._e()],2)},we=[],be="".concat(x,"-resizer"),Me=4,Se=r["a"].extend({name:"Resizer",props:{controlStyle:{type:Object,default:function(){return Object.assign({},v)}},showResizers:{type:Boolean,default:!0},canvasScale:Number,canvasPadding:Number},data:function(){return{prefixCls:be,resizerHalfSize:Me}},methods:{handleResizerMouseDown:function(t,e){this.$emit("resizer-mousedown",t,e)}}}),Ne=Se,De=Object(P["a"])(Ne,Ce,we,!1,null,null,null),Ae=De.exports,Le=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.prefixCls},[n("div",{directives:[{name:"show",rawName:"v-show",value:!isNaN(t.horizontalLine),expression:"!isNaN(horizontalLine)"}],class:[t.prefixCls+"__line",t.prefixCls+"__line-horizontal"],style:{top:t.horizontalLine*t.canvasScale+t.canvasPadding+"px",width:t.canvasTotalWidth+"px"}}),n("div",{directives:[{name:"show",rawName:"v-show",value:!isNaN(t.verticalLine),expression:"!isNaN(verticalLine)"}],class:[t.prefixCls+"__line",t.prefixCls+"__line-vertical"],style:{left:t.verticalLine*t.canvasScale+t.canvasPadding+"px",height:t.canvasTotalHeight+"px"}})])},Oe=[],_e="".concat(x,"-attach-line"),Pe=r["a"].extend({name:"AttachLine",props:{horizontalLine:{type:Number,default:0},verticalLine:{type:Number,default:0},canvasScale:Number,canvasSize:Object,canvasPadding:Number},data:function(){return{prefixCls:_e}},computed:{canvasTotalWidth:function(){return this.canvasSize.width+2*this.canvasPadding},canvasTotalHeight:function(){return this.canvasSize.height+2*this.canvasPadding}}}),ze=Pe,je=Object(P["a"])(ze,Le,Oe,!1,null,null,null),Ee=je.exports;function Ie(t){return Be(t)||Te(t)||$e()}function $e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Te(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function Be(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var He=function(t){var e=Math.min.apply(Math,Ie(t.map((function(t){return t.x})))),n=Math.min.apply(Math,Ie(t.map((function(t){return t.y})))),a=Math.max.apply(Math,Ie(t.map((function(t){return t.x})))),i=Math.max.apply(Math,Ie(t.map((function(t){return t.y}))));return{width:a-e,height:i-n,x:e,y:n}},Fe=function(t){var e=[];return t.forEach((function(t){if(t instanceof rt){var n=t.style,i=n.x,r=n.y,o=n.width,s=n.height,l=n.rotate;e.push(G({x:i,y:r},t.center,l)),e.push(G({x:i+o,y:r},t.center,l)),e.push(G({x:i,y:r+s},t.center,l)),e.push(G({x:i+o,y:r+s},t.center,l))}else t.linkType===a.polyline?e.push.apply(e,Ie(t.polylinePoints)):(e.push(t.startCoordinate_),e.push(t.endCoordinate_))})),He(e)},Re=function(t,e){return t.x>=e.x&&t.x+t.width<=e.x+e.width&&t.y>=e.y&&t.y+t.height<=e.y+e.height},Ue=function(t,e){return Re(t.style,e)},Ke=function(t,e){var n;return n=t.linkType===a.polyline?He(t.polylinePoints):He([t.startCoordinate_,t.endCoordinate_]),Re(n,e)},We=function(t,e){var n=[];return e.nodes.forEach((function(e){Ue(e,t)&&n.push(e)})),e.links.forEach((function(e){Ke(e,t)&&n.push(e)})),n};function Ze(t){return Ge(t)||Xe(t)||Ye()}function Ye(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Xe(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function Ge(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ve(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Je(t,e,n){return e&&Ve(t.prototype,e),n&&Ve(t,n),t}var Qe=function(){function t(e){qe(this,t),this.set=[],e&&(this.set=Ze(new Set(e)))}return Je(t,[{key:"has",value:function(t){return this.set.indexOf(t)>-1}},{key:"add",value:function(t){return this.has(t)||this.set.push(t),this.set}},{key:"clear",value:function(){this.set.splice(0,this.size)}},{key:"delete",value:function(t){var e=this.set.indexOf(t);return e>-1&&(this.set.splice(e,1),!0)}},{key:"forEach",value:function(t,e){var n=this;this.set.forEach((function(a){t.call(e,a,a,n)}))}},{key:"size",get:function(){return this.set.length}}]),t}(),tn=function(t){var e=[];return t.forEach((function(t){e.push(t)})),e},en={center:{horizontal:[],vertical:[]},edge:{horizontal:[],vertical:[]}},nn=3;function an(t){var e=A()(en),n=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e=A()(en),t.flowChartData.nodes.forEach((function(t){if(-1===n.indexOf(t.id)){var a=t.center;e.center.horizontal.push(a.y),e.center.vertical.push(a.x),e.edge.horizontal.push(t.style.y),e.edge.horizontal.push(t.style.y+t.style.height),e.edge.vertical.push(t.style.x),e.edge.vertical.push(t.style.x+t.style.width)}}))},a=function(){n()},i=function(e,n){t.createNode.controlName=e,Object.assign(t.createNode.style,n)},r=function(e){t.createNode.style.x=e.x,t.createNode.style.y=e.y},o=function(){var e=[];t.selectedChartSet.forEach((function(t){t instanceof rt&&e.push(t.id)})),n(e)},s=function(){t.attachLine.horizontal=NaN,t.attachLine.vertical=NaN},l=function(n){s();var a=!1,i=!1,r=!1,o=!1,l={x:0,y:0},c={x:Math.trunc(n.x+n.width/2),y:Math.trunc(n.y+n.height/2)};if(e.center.horizontal.some((function(e){var n=e-c.y;return Math.abs(n)<=nn&&(l.y=n,a=!0,r=!0,t.attachLine.horizontal=e),a})),e.center.vertical.some((function(e){var n=e-c.x;return Math.abs(n)<=nn&&(l.x=n,i=!0,o=!0,t.attachLine.vertical=e),i})),!a){var h=[n.y,n.y+n.height];e.edge.horizontal.some((function(e){return h.some((function(n){var i=e-n;return Math.abs(i)<=nn&&(l.y=i,a=!0,t.attachLine.horizontal=e),a}))}))}if(!i){var d=[n.x,n.x+n.width];e.edge.vertical.some((function(e){return d.some((function(n){var a=e-n;return Math.abs(a)<=nn&&(l.x=a,i=!0,t.attachLine.vertical=e),i}))}))}return{attach:a||i,offset:l,isHorizontalCenterAttached:r,isVerticalCenterAttached:o}};return{updateCreatingNodePossibleLines:a,updateCreateNodeControlAndSize:i,updateCreateNodePosition:r,updateMovingNodePossibleLines:o,clearAttachLine:s,shouldAttach:l}}function rn(t){var e=!1,n=function(n){e&&(t.isCreatingLink=!0),t.isCreatingLink&&(t.createLink.endNodeId=null,t.createLink.endCoordinate=t.getMouseCoordinate(n))},a=function(n){t.isCreatingLink&&(t.createLink.endCoordinate=t.getMouseCoordinate(n),t.createNewLink(),t.isCreatingLink=!1),e=!1},i=function(n,a,i){e&&(t.isCreatingLink=!0),t.isCreatingLink&&(a.stopPropagation(),t.createLink.endNodeId=n.id,t.createLink.endAnchor=i)},r=function(n,a){e=!0,t.createLink.startNodeId=n.id,t.createLink.startAnchor=a},o=function(e,n,a){t.isCreatingLink&&(t.createLink.endNodeId=e.id,t.createLink.endAnchor=n)},s=function(n,a,i){t.isCreatingLink&&(t.createLink.endNodeId=n.id,t.createLink.endAnchor=a,t.createNewLink(),t.isCreatingLink=!1),e=!1};return{onBackgroundMouseMove:n,onBackgroundMouseUp:a,onNodeMouseMove:i,onAnchorMouseDown:r,onAnchorMouseMove:o,onAnchorMouseUp:s}}function on(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?on(Object(n),!0).forEach((function(e){ln(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ln(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function cn(t,e){var n=!1,a={clientX:0,clientY:0},i=function(i){if(n&&!t.isMovingChart&&(t.isMovingChart=!0,e.updateMovingNodePossibleLines()),t.isMovingChart){var r=Object.assign({},a),o={clientX:Math.trunc(i.clientX),clientY:Math.trunc(i.clientY)};if(!C(i,t.$refs.canvas)){var s=k(t.$refs.canvas);o.clientX=s.left,o.clientY=s.top}var l={x:Math.trunc((o.clientX-a.clientX)/t.canvasScale),y:Math.trunc((o.clientY-a.clientY)/t.canvasScale)};a.clientX=o.clientX,a.clientY=o.clientY;var c=Fe(tn(t.selectedChartSet)),h=sn({},c,{x:c.x+l.x,y:c.y+l.y}),d=e.shouldAttach(h);d.attach&&(l.x+=d.offset.x,l.y+=d.offset.y,a.clientX+=d.offset.x*t.canvasScale,a.clientY+=d.offset.y*t.canvasScale),0===l.x&&(a.clientX=r.clientX),0===l.y&&(a.clientY=r.clientY),t.moveSelectedCharts(l)}},r=function(e){t.isMovingChart&&(t.isMovingChart=!1,t.$emit("take-snapshot")),n=!1},o=function(t,e){n=!0,a.clientX=Math.trunc(e.clientX),a.clientY=Math.trunc(e.clientY)},s=function(t,e,i,r){i||t.startNodeId||t.endNodeId||(n=!0,a.clientX=Math.trunc(e.clientX),a.clientY=Math.trunc(e.clientY))};return{onBackgroundMouseMove:i,onBackgroundMouseUp:r,onNodeMouseDown:o,onLinkMouseDown:s}}function hn(t){var e=!1,n="start",a=function(a){if(e&&(t.isMovingLinkAnchor=!0),t.isMovingLinkAnchor){var i=t.moveLinkAnchor;i["".concat(n,"NodeId")]=null,i["".concat(n,"Coordinate")]=t.getMouseCoordinate(a)}},i=function(n){t.isMovingLinkAnchor&&(t.isMovingLinkAnchor=!1,t.moveLinkAnchor&&(Mt(t.moveLinkAnchor,t.flowChartData)&&(!t.allowFreeLink&&!t.moveLinkAnchor.isLinkFree()||t.allowFreeLink)?t.$emit("take-snapshot"):t.$emit("revert-snapshot"))),e=!1},r=function(a,i,r){if(e&&(t.isMovingLinkAnchor=!0),t.isMovingLinkAnchor){i.stopPropagation();var o=t.moveLinkAnchor;o["".concat(n,"NodeId")]=a.id,o["".concat(n,"Anchor")]=r}},o=function(e,a,i){if(t.isMovingLinkAnchor){var r=t.moveLinkAnchor;r["".concat(n,"NodeId")]=e.id,r["".concat(n,"Anchor")]=a}},s=function(a,i,r){if(t.isMovingLinkAnchor){var o=t.moveLinkAnchor;o["".concat(n,"NodeId")]=a.id,o["".concat(n,"Anchor")]=i,t.isMovingLinkAnchor=!1,t.moveLinkAnchor&&(Mt(t.moveLinkAnchor,t.flowChartData)&&(!t.allowFreeLink&&!t.moveLinkAnchor.isLinkFree()||t.allowFreeLink)?t.$emit("take-snapshot"):t.$emit("revert-snapshot"))}e=!1},l=function(a,i,r){e=!0,t.moveLinkAnchor=a,n=r,t.moveLinkAnchor["".concat(n,"NodeId")]=null,t.moveLinkAnchor["".concat(n,"Coordinate")]=t.getMouseCoordinate(i)},c=function(t,e){l(t,e,"start")},h=function(t,e){l(t,e,"end")};return{onBackgroundMouseMove:a,onBackgroundMouseUp:i,onNodeMouseMove:r,onAnchorMouseMove:o,onAnchorMouseUp:s,onLinkStartAnchorMouseDown:c,onLinkEndAnchorMouseDown:h}}function dn(t){var e=!1,n=!1,a=null,i=0,r=function(r){if(e&&(n=!0),n){var o=a,s=o.getPolylineDirectionByIndex(i),l=t.getMouseCoordinate(r);"x"===s?o.setPolylinePosition(i,l.y):"y"===s&&o.setPolylinePosition(i,l.x)}},o=function(a){n&&(n=!1,t.$emit("take-snapshot")),e=!1},s=function(t,n,r,o){r&&(e=!0,a=t,i=o)};return{onBackgroundMouseMove:r,onBackgroundMouseUp:o,onLinkMouseDown:s}}function un(t,e){var n=!1,a={x:0,y:0},i="00",r="00",o={"00":{x:0,y:0},10:{x:1,y:0},"01":{x:0,y:1},11:{x:1,y:1}},s=function(s){n&&!t.isResizingNode&&(t.isResizingNode=!0,e.updateMovingNodePossibleLines());var l=tn(t.selectedChartSet)[0];if(t.isResizingNode&&1===t.selectedChartSet.size&&l instanceof rt){var c=t.getMouseCoordinate(s),h={x:Number(r[0]),y:Number(r[1])};c=Q(a,h,c,l.style.rotate),o[i]=c,o["".concat(r[0]).concat(1-Number(r[1]))]=J(a,c,l.style.rotate),o["".concat(1-Number(r[0])).concat(r[1])]=J(c,a,l.style.rotate);var d=V(Object.values(o)),u={width:Math.trunc(w(o["00"],o["10"])),height:Math.trunc(w(o["00"],o["01"])),x:d.x,y:d.y},f={x:0,y:0},y=e.shouldAttach(u);y.attach&&(f=y.offset,y.isHorizontalCenterAttached&&(f.y=2*y.offset.y),y.isVerticalCenterAttached&&(f.x=2*y.offset.x)),"1"===r[0]?(u.width-=f.x,u.x+=f.x):u.width+=f.x,"1"===r[1]?(u.height-=f.y,u.y+=f.y):u.height+=f.y,Object.assign(l.style,u)}},l=function(e){t.isResizingNode&&(t.isResizingNode=!1,t.$emit("take-snapshot")),n=!1},c=function(e,s){var l=Fe(tn(t.selectedChartSet));n=!0,i=s,r="".concat(1-Number(s[0])).concat(1-Number(s[1])),a=q(Object.assign({},l,{rotate:0}),l,{x:Number(r[0]),y:Number(r[1])}),o[r]=a};return{onBackgroundMouseMove:s,onBackgroundMouseUp:l,onResizerMouseDown:c}}function fn(t){var e=!1,n=function(n){n.target!==t.$refs.canvas&&n.target!==t.$refs.background||(t.selectedChartSet.clear(),e=!0,t.selectingAreaStart=t.getMouseCoordinate(n))},a=function(n){e&&(t.isSelectingArea=!0),t.isSelectingArea&&(t.selectingAreaEnd=t.getMouseCoordinate(n))},i=function(n){if(t.isSelectingArea){var a=He([t.selectingAreaStart,t.selectingAreaEnd]),i=We(a,t.flowChartData);i.forEach((function(e){t.selectedChartSet.add(e)})),t.isSelectingArea=!1}e=!1},r=function(e,n){t.selectedChartSet.has(e)||(t.selectedChartSet.clear(),t.selectedChartSet.add(e))},o=function(e,n){t.selectedChartSet.add(e)},s=function(e,n,a,i){t.selectedChartSet.has(e)||(t.selectedChartSet.clear(),t.selectedChartSet.add(e))},l=function(e,n){t.selectedChartSet.add(e)};return{onBackgroundMouseDown:n,onBackgroundMouseMove:a,onBackgroundMouseUp:i,onNodeMouseDown:r,onNodeCtrlMouseDown:o,onLinkMouseDown:s,onLinkCtrlMouseDown:l}}function yn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function vn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yn(Object(n),!0).forEach((function(e){pn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function pn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var gn="".concat(x,"-chart-zone"),xn="".concat(x,"-link"),kn={startNodeId:null,startAnchor:{x:0,y:0},startCoordinate:{x:0,y:0}},mn={endNodeId:null,endAnchor:{x:0,y:0},endCoordinate:{x:0,y:0}},Cn=r["a"].extend({name:"ChartZone",inheritAttrs:!1,components:{Node:j,Link:le,Anchor:me,Resizer:Ae,AttachLine:Ee},props:{flowChartData:{required:!0,type:Object},isCreatingNode:Boolean,isMouseInsideCanvas:Boolean,flowChartCreateNode:Object,linkType:String,linkEditor:Object,linkEditorWidth:Number,linkEditorHeight:Number,allowFreeLink:Boolean,chartClassNameMethod:Function,isChartEditable:Function,canvasScale:Number,canvasSize:Object,canvasPadding:Number,linkArrowWidth:Number,linkArrowHeight:Number,readonly:Boolean,provideChartProps:{}},data:function(){return{prefixCls:gn,linkPrefixCls:xn,selectedChartSet:new Qe,isSelectingArea:!1,selectingAreaStart:{x:0,y:0},selectingAreaEnd:{x:0,y:0},isGroupShow:!1,mouseMoveNodeId:null,isMovingChart:!1,isResizingNode:!1,isMovingLinkAnchor:!1,moveLinkAnchor:null,isCreatingLink:!1,createLink:new ft(vn({},A()(kn),{},A()(mn),{linkType:this.linkType})),createNode:new rt({controlName:"",style:{}}),attachLine:{horizontal:NaN,vertical:NaN},eventHandlers:{onBackgroundMouseDown:[],onBackgroundMouseMove:[],onBackgroundMouseUp:[],onNodeMouseDown:[],onNodeCtrlMouseDown:[],onNodeMouseMove:[],onAnchorMouseDown:[],onAnchorMouseMove:[],onAnchorMouseUp:[],onResizerMouseDown:[],onLinkMouseDown:[],onLinkCtrlMouseDown:[],onLinkStartAnchorMouseDown:[],onLinkEndAnchorMouseDown:[]}}},computed:{tailZStyle:function(){return{zIndex:this.flowChartData.getMaxZ()+1}},selectingAreaStyle:function(){var t=He([this.selectingAreaStart,this.selectingAreaEnd]);return{width:"".concat(t.width*this.canvasScale,"px"),height:"".concat(t.height*this.canvasScale,"px"),top:"".concat(t.y*this.canvasScale+this.canvasPadding,"px"),left:"".concat(t.x*this.canvasScale+this.canvasPadding,"px")}},resizerArea:function(){return Fe(tn(this.selectedChartSet))},showResizers:function(){var t=tn(this.selectedChartSet)[0];return 1===this.selectedChartSet.size&&t instanceof rt&&t.control.resizable},shouldResizerFrameShow:function(){return this.selectedChartSet.size>1||this.showResizers}},methods:{selectChart:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.selectedChartSet.clear();var n=this.flowChartData.findChartById(t);n&&this.selectedChartSet.add(n)},unselectChart:function(t){var e=this.flowChartData.findChartById(t);e&&this.selectedChartSet.delete(e)},moveSelectedCharts:function(t){var e=this;this.selectedChartSet.forEach((function(e){e.moveByOffset(t)})),this.flowChartData.links.forEach((function(n){if(n.startNodeId&&n.endNodeId){var a=e.flowChartData.findChartById(n.startNodeId),i=e.flowChartData.findChartById(n.endNodeId);e.selectedChartSet.has(a)&&e.selectedChartSet.has(i)&&!e.selectedChartSet.has(n)&&n.moveByOffset(t)}}))},moveCanvas:function(t){this.$refs.background.scrollTop+=t.y*this.canvasScale,this.$refs.background.scrollLeft+=t.x*this.canvasScale},createNewLink:function(){var t=vn({},this.createLink,{id:"",linkType:this.linkType,linkData:{text:""}});delete t.z,Mt(t,this.flowChartData)&&(!this.allowFreeLink&&!this.createLink.isLinkFree()||this.allowFreeLink)?this.$emit("add-link",t):this.$emit("revert-snapshot")},getMouseCoordinate:function(t){var e=m(t,this.$refs.canvas);return{x:Math.trunc((e.x-this.canvasPadding)/this.canvasScale),y:Math.trunc((e.y-this.canvasPadding)/this.canvasScale)}},getNearestAnchor:function(t,e){var n=this,a={x:0,y:0},i=1/0;return e.anchors.forEach((function(r,o){var s=N(e.getAnchorCoordinate(r),n.canvasScale),l=w(s,t);l<i&&(i=l,a=r)})),a},isLinkSelected:function(t){return this.selectedChartSet.has(t)},isNodeSelected:function(t){return this.selectedChartSet.has(t)},isMouseMoveNode:function(t){return this.mouseMoveNodeId===t.id},handleBackgroundMouseDown:function(t){var e=!0,n=!1,a=void 0;try{for(var i,r=this.eventHandlers.onBackgroundMouseDown[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.call(this,t)}}catch(s){n=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}},handleBackgroundMouseMove:function(t){if(!this.readonly){var e=!0,n=!1,a=void 0;try{for(var i,r=this.eventHandlers.onBackgroundMouseMove[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.call(this,t)}}catch(s){n=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}}},handleBackgroundMouseUp:function(t){if(!this.readonly){var e=!0,n=!1,a=void 0;try{for(var i,r=this.eventHandlers.onBackgroundMouseUp[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.call(this,t)}}catch(s){n=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}}},handleNodeMouseDown:function(t,e){if(!this.readonly){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onNodeMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},handleNodeCtrlMouseDown:function(t,e){if(!this.readonly){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onNodeCtrlMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},handleNodeMouseMove:function(t,e){if(!this.readonly){this.mouseMoveNodeId=t.id;var n=m(e,this.$refs.canvas),a={x:Math.trunc(n.x-this.canvasPadding),y:Math.trunc(n.y-this.canvasPadding)},i=this.getNearestAnchor(a,t),r=!0,o=!1,s=void 0;try{for(var l,c=this.eventHandlers.onNodeMouseMove[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var h=l.value;h.call(this,t,e,i)}}catch(d){o=!0,s=d}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}}},handleNodeMouseMoveOutside:function(t){this.readonly||this.mouseMoveNodeId===t.id&&(this.mouseMoveNodeId=null)},handleAnchorMouseDown:function(t,e){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onAnchorMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}},handleAnchorMouseMove:function(t,e,n){n.stopPropagation();var a=!0,i=!1,r=void 0;try{for(var o,s=this.eventHandlers.onAnchorMouseMove[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;l.call(this,t,e,n)}}catch(c){i=!0,r=c}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}},handleAnchorMouseUp:function(t,e,n){n.stopPropagation();var a=!0,i=!1,r=void 0;try{for(var o,s=this.eventHandlers.onAnchorMouseUp[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;l.call(this,t,e,n)}}catch(c){i=!0,r=c}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}},handleResizerMouseDown:function(t,e){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onResizerMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}},handleLinkMouseDown:function(t,e,n,a){if(!this.readonly){var i=!0,r=!1,o=void 0;try{for(var s,l=this.eventHandlers.onLinkMouseDown[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;c.call(this,t,e,n,a)}}catch(h){r=!0,o=h}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}}},handleLinkCtrlMouseDown:function(t,e){if(!this.readonly){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onLinkCtrlMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},handleLinkStartAnchorMouseDown:function(t,e){if(!this.readonly){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onLinkStartAnchorMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},handleLinkEndAnchorMouseDown:function(t,e){if(!this.readonly){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onLinkEndAnchorMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},handleLinkTextChange:function(t,e){t.linkData.text=e}},mounted:function(){var t=this;this.$refs.background.scrollTop=this.canvasPadding*this.canvasScale,this.$refs.background.scrollLeft=this.canvasPadding*this.canvasScale;var e=an(this),n=[rn(this),cn(this,e),hn(this),dn(this),un(this,e),fn(this)];n.forEach((function(e){for(var n in e){var a=n,i=e[a],r=t.eventHandlers[a];r.push(i)}}))},watch:{isCreatingLink:function(t){t?Object.assign(this.createLink,{linkType:this.linkType}):Object.assign(this.createLink,A()(kn),A()(mn))},isMovingLinkAnchor:function(t){t||this.$emit("link-position-change",this.moveLinkAnchor)},"selectedChartSet.size":{immediate:!0,handler:function(t){this.$emit("selected-size-change",t)}}}}),wn=Cn,bn=Object(P["a"])(wn,kt,mt,!1,null,null,null),Mn=bn.exports;function Sn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Nn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Sn(Object(n),!0).forEach((function(e){Dn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Dn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function An(t,e){var n={x:0,y:0},a={x:0,y:0},i=function(){Object.assign(t.createNode.style,n)},r=function(r){var o={x:0,y:0},s={x:0,y:0},l=m(r,t.$refs.flowchart);if(t.isMouseInsideCanvas=C(r,t.$refs.chartzone.$refs.background),t.isMouseInsideCanvas){var c=m(r,t.$refs.chartzone.$refs.canvas);a={x:Math.trunc((c.x-t.createNode.style.width*t.canvasScale/2-t.canvasPadding)/t.canvasScale),y:Math.trunc((c.y-t.createNode.style.height*t.canvasScale/2-t.canvasPadding)/t.canvasScale)};var h=e.shouldAttach(Nn({},t.createNode.style,{},a));h.attach&&(o=h.offset),a.x+=o.x,a.y+=o.y,e.updateCreateNodePosition(a),s.x=Math.trunc(c.x/t.canvasScale)*t.canvasScale-c.x,s.y=Math.trunc(c.y/t.canvasScale)*t.canvasScale-c.y}n.x=Math.trunc(l.x-t.createNode.style.width*t.canvasScale/2+o.x*t.canvasScale+s.x),n.y=Math.trunc(l.y-t.createNode.style.height*t.canvasScale/2+o.y*t.canvasScale+s.y),i()},o=function(n,a){t.isCreatingNode=!0,t.createNode.controlName=n.controlName;var i={};null!=t.createNode.control.defaultWidth&&(i.width=t.createNode.control.defaultWidth),null!=t.createNode.control.defaultHeight&&(i.height=t.createNode.control.defaultHeight);var o=Nn({width:v.width,height:v.height},i);Object.assign(t.createNode.style,o),e.updateCreateNodeControlAndSize(n.controlName,o),e.updateCreatingNodePossibleLines(),e.clearAttachLine(),r(a)},s=function(e){t.isCreatingNode&&(t.isCreateNodeShow=!0,r(e))},l=function(e){if(t.isCreatingNode){var n=t.$refs.chartzone.$refs.background;if(C(e,n)){var i={width:t.createNode.style.width,height:t.createNode.style.height,x:t.createNode.style.x,y:t.createNode.style.y},r=t.addNode({controlName:t.createNode.controlName,style:Nn({},i,{x:a.x,y:a.y}),nodeData:{}});t.$nextTick((function(){t.$refs.chartzone.selectChart(r.id)}))}t.isCreateNodeShow=!1,t.isCreatingNode=!1}};return{onDragZoneNodeMouseDown:o,onFlowChartMouseMove:s,onDocumentMouseUp:l}}var Ln=x,On=function(t){return t.map((function(t){return Object.assign({},y,t)}))},_n=function(t){var e={};return t.forEach((function(t){e[t.controlName]=t})),e},Pn=r["a"].extend({name:"FlowChart",components:{DragZone:xt,ChartZone:Mn,Node:j},props:{data:{type:Object,default:function(){return{nodes:[],links:[]}}},controlList:{type:Array,default:function(){return[]}},linkType:{type:String,default:a.straight},linkEditor:Object,linkEditorWidth:{type:Number,default:170},linkEditorHeight:{type:Number,default:70},allowFreeLink:{type:Boolean,default:!0},maxSnapshots:{type:Number,default:10},readonly:Boolean,chartClassNameMethod:{type:Function,default:function(){return function(){return{}}}},isChartDeletable:{type:Function,default:function(){return function(){return!0}}},isChartEditable:{type:Function,default:function(){return function(){return!0}}},canvasScale:{type:Number,default:1,validator:function(t){return t>0}},canvasSize:{type:Object,default:function(){return Object.assign({},p)}},canvasPadding:{type:Number,default:1e3},linkArrowWidth:{type:Number,default:11},linkArrowHeight:{type:Number,default:10},provideChartProps:{}},data:function(){var t=new K(this.data,_n(On(this.controlList)));return{prefixCls:Ln,flowChartData:t,processedCanvasSize:Object.assign({},this.canvasSize),snapshots:[A()(t)],redoStack:[],isCreatingNode:!1,isCreateNodeShow:!1,createNode:new rt({controlName:"",style:{}}),isMouseInsideCanvas:!1,eventHandlers:{onDragZoneNodeMouseDown:[],onFlowChartMouseMove:[],onDocumentMouseUp:[]}}},computed:{processedControlList:function(){return On(this.controlList)},controlMap:function(){return _n(this.processedControlList)}},methods:{getFlowChart:function(){return this.flowChartData},getSelectedCharts:function(){return tn(this.$refs.chartzone.selectedChartSet)},clearSelectedCharts:function(){this.$refs.chartzone.selectedChartSet.clear()},getStartCharts:function(){return this.flowChartData.getStartCharts()},addNode:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.flowChartData.addNode(t);return e&&this.takeSnapshot(),n},addLink:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.flowChartData.addLink(t);return e&&this.takeSnapshot(),n},deleteCharts:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach((function(t){e.$refs.chartzone.unselectChart(t)})),this.flowChartData.deleteCharts(t,this.isChartDeletable).length&&(this.$emit("chart-delete",t),n&&this.takeSnapshot())},deleteChart:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.$refs.chartzone.unselectChart(t),this.flowChartData.deleteChart(t,this.isChartDeletable)&&(this.$emit("chart-delete",[t]),e&&this.takeSnapshot())},setChartData:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.flowChartData.setChartData(t,e)&&n&&this.takeSnapshot()},deleteChartData:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.flowChartData.deleteChartData(t,e)&&n&&this.takeSnapshot()},updateProcessedCanvasSize:function(){var t=this.flowChartData.getCharts();if(t.length){var e=Fe(t),n={x:0,y:0};e.x<0&&(n.x=100*Math.ceil(Math.abs(e.x)/100),this.processedCanvasSize.width+=n.x),e.y<0&&(n.y=100*Math.ceil(Math.abs(e.y)/100),this.processedCanvasSize.height+=n.y),t.forEach((function(t){return t.moveByOffset(n)})),(e.x<0||e.y<0)&&this.$refs.chartzone.moveCanvas(n),e=Fe(t);var a=e.x+e.width,i=e.y+e.height;this.processedCanvasSize.width=this.canvasSize.width+100*Math.ceil(Math.max(a-this.canvasSize.width,0)/100),this.processedCanvasSize.height=this.canvasSize.height+100*Math.ceil(Math.max(i-this.canvasSize.height,0)/100)}},takeSnapshot:function(){if(!this.readonly){this.snapshots.unshift(A()(this.flowChartData));while(this.snapshots.length+1>this.maxSnapshots)this.snapshots.pop();this.redoStack=[],this.updateProcessedCanvasSize()}},replaceSnapshot:function(){this.readonly||(this.snapshots[0]=A()(this.flowChartData))},undo:function(){this.readonly||this.snapshots.length<=1||(this.resetFlowChartData(this.snapshots[1]),this.redoStack.unshift(this.snapshots.shift()),this.updateProcessedCanvasSize())},redo:function(){if(!this.readonly&&this.redoStack.length){var t=this.redoStack.shift();this.resetFlowChartData(t),this.snapshots.unshift(t),this.updateProcessedCanvasSize()}},revert:function(){this.readonly||this.snapshots.length&&(this.resetFlowChartData(this.snapshots[0]),this.updateProcessedCanvasSize())},fixSnapshot:function(){this.readonly||(this.snapshots=[],this.takeSnapshot())},resetFlowChartData:function(t){var e=this,n=this.getSelectedCharts();this.flowChartData.clearCharts(),this.$nextTick((function(){e.flowChartData=A()(t),e.flowChartData.updateNodesRecord(),e.$nextTick((function(){e.clearSelectedCharts(),n.forEach((function(t){e.$refs.chartzone.selectChart(t.id,!1)})),e.$refs.flowchart.focus()}))}))},handleDragZoneNodeMouseDown:function(t,e){var n=!0,a=!1,i=void 0;try{for(var r,o=this.eventHandlers.onDragZoneNodeMouseDown[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.call(this,t,e)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}},handleFlowChartMouseMove:function(t){var e=!0,n=!1,a=void 0;try{for(var i,r=this.eventHandlers.onFlowChartMouseMove[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.call(this,t)}}catch(s){n=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}},handleDocumentMouseUp:function(t){var e=!0,n=!1,a=void 0;try{for(var i,r=this.eventHandlers.onDocumentMouseUp[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.call(this,t)}}catch(s){n=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}},handleDeleteCharts:function(t){this.readonly||"Delete"!==t.code&&46!==t.keyCode||this.deleteCharts(this.getSelectedCharts().map((function(t){return t.id})))},handleFlowChartKeyDown:function(t){if(t.code in i){t.preventDefault();var e=10;(t.ctrlKey||t.shiftKey)&&(e=1);var n={x:e,y:e};t.code===i.ArrowLeft?(n.x*=-1,n.y=0):t.code===i.ArrowRight?n.y=0:t.code===i.ArrowUp?(n.x=0,n.y*=-1):n.x=0,this.$refs.chartzone.moveSelectedCharts(n),this.takeSnapshot()}},handleCtrlKeyDown:function(t){var e=this;this.readonly||("KeyZ"===t.code?this.undo():"KeyY"===t.code?this.redo():"KeyA"===t.code&&(t.preventDefault(),this.flowChartData.getCharts().forEach((function(t){e.$refs.chartzone.selectChart(t.id,!1)}))))}},mounted:function(){var t=this;this.updateProcessedCanvasSize(),document.addEventListener("mouseup",this.handleDocumentMouseUp);var e=[An(this,an(this.$refs.chartzone))];e.forEach((function(e){for(var n in e){var a=n,i=e[a],r=t.eventHandlers[a];r.push(i)}}))},beforeDestroy:function(){document.removeEventListener("mouseup",this.handleDocumentMouseUp)},watch:{data:function(t){this.flowChartData=new K(t,this.controlMap),this.snapshots=[A()(this.flowChartData)],this.redoStack=[],this.clearSelectedCharts(),this.updateProcessedCanvasSize()},controlMap:function(t){this.flowChartData.updateControlMap(t)},snapshots:{immediate:!0,handler:function(){var t=this.snapshots.length>1;this.$emit("undo-change",t)}},redoStack:{immediate:!0,handler:function(){var t=!!this.redoStack.length;this.$emit("redo-change",t)}}}}),zn=Pn,jn=Object(P["a"])(zn,l,c,!1,null,null,null),En=jn.exports,In=(n("a4b1"),En),$n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("input",{ref:"input",attrs:{type:"text",placeholder:t.isThumbnail?"":"双击在节点中输入内容"}}),t.isThumbnail?t._e():n("div",[t._v("\n    处于编辑状态："+t._s(t.isEditing)),n("br"),t._v("\n    连接的节点数："+t._s(t.linkedNodeCount)+"\n  ")])])},Tn=[],Bn={name:"FlowInput",props:{isThumbnail:Boolean,isEditing:Boolean,node:Object,flowChartData:Object},computed:{linkedNodeCount:function(){var t=this;return this.flowChartData.links.filter((function(e){return e.startNodeId===t.node.id&&e.endNodeId})).length}},watch:{isEditing:function(t){t&&this.$refs.input.focus()}}},Hn=Bn,Fn=(n("f1ef"),Object(P["a"])(Hn,$n,Tn,!1,null,"8b423998",null)),Rn=Fn.exports,Un={name:"App",components:{FlowChart:In},data:function(){return{linkType:"polyline",canvasScale:1,controlList:[{controlName:"FlowInput",component:Rn,label:"输入框",disableLinkSelf:!0,defaultWidth:200,defaultHeight:100}]}}},Kn=Un,Wn=(n("42b1"),Object(P["a"])(Kn,o,s,!1,null,null,null)),Zn=Wn.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(Zn)}}).$mount("#app")},f1ef:function(t,e,n){"use strict";var a=n("1865"),i=n.n(a);i.a}});